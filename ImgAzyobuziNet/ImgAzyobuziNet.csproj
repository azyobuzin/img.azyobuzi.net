<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <VersionPrefix>3.0.0</VersionPrefix>
    <Authors>azyobuzin</Authors>
    <TargetFramework>netcoreapp1.1</TargetFramework>
    <PackageProjectUrl>http://img.azyobuzi.net/</PackageProjectUrl>
    <PackageLicenseUrl>https://github.com/azyobuzin/img.azyobuzi.net/blob/master/LICENSE.txt</PackageLicenseUrl>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.AspNetCore" Version="1.1.1" />
    <PackageReference Include="Microsoft.AspNetCore.HttpOverrides" Version="1.1.1" />
    <PackageReference Include="Microsoft.AspNetCore.Mvc" Version="1.1.2" />
    <PackageReference Include="Microsoft.AspNetCore.StaticFiles" Version="1.1.1" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\ImgAzyobuziNet.Core\ImgAzyobuziNet.Core.csproj" />
  </ItemGroup>

  <ItemGroup>
    <Folder Include="wwwroot\" />
  </ItemGroup>

  <ItemGroup>
    <Content Update="appsettings.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
  </ItemGroup>

  <Target Name="DockerBuild" DependsOnTargets="Publish">
    <PropertyGroup>
      <DockerBuildRepository Condition="'$(DockerBuildRepository)' == ''">azyobuzin/img.azyobuzi.net</DockerBuildRepository>
      <DockerBuildTag Condition="'$(DockerBuildTag)' == '' and '$(Configuration)' == 'Release'">latest</DockerBuildTag>
      <DockerBuildTag Condition="'$(DockerBuildTag)' == ''">$(Configuration.ToLowerInvariant())</DockerBuildTag>
    </PropertyGroup>
    <Exec Command="docker build -t &quot;$(DockerBuildRepository):$(DockerBuildTag)&quot; --build-arg &quot;configuration=$(Configuration)&quot; ." />
  </Target>
</Project>
